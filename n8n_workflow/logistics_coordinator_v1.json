{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "bestar-whatsapp",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        600
      ],
      "id": "f5639073-adda-480f-9d7c-420c7f5ed41a",
      "name": "Whatsapp",
      "webhookId": "d8fa5154-f391-43c2-ad0c-f5c7b3eb2737"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"remoteJid\": \"{{ $json.body.data.key.remoteJid }}\",\n  \"sender_phone\": \"{{ $json.body.data.key.participant || $json.body.data.key.remoteJid }}\",\n  \"sender_name\": \"{{ $json.body.data.pushName || 'Ù…Ø¬Ù‡ÙˆÙ„' }}\",\n  \"message_text\": \"{{ $json.body.data.message.conversation || $json.body.data.message.extendedTextMessage?.text || '' }}\",\n  \"instance\": \"{{ $json.body.instance }}\",\n  \"is_group\": {{ $json.body.data.key.remoteJid?.includes(\"@g.us\") || false }}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        240,
        600
      ],
      "id": "5e8ec891-9e44-4253-8c51-393b97b28fc7",
      "name": "Extract Message Data"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6b94d821-efef-46e8-9aa1-8ac7bc58c9da",
              "leftValue": "={{ $json.message_text }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        460,
        600
      ],
      "id": "bef7ede2-901a-4d1b-bd8f-eebdcea92af1",
      "name": "Is Not Empty?"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/checklist/settings",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        680,
        600
      ],
      "id": "c6e795d5-a395-4205-9ce9-3ced136bd99a",
      "name": "Get Routing Settings",
      "continueOnFail": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "id": "4572dcc7-0ce4-4a5d-951d-0e5ab71545d9",
              "v": "={{ $json.manager_phone + '@s.whatsapp.net' }}",
              "operator": "equal",
              "column": "={{ $('Extract Message Data').item.json.remoteJid }}"
            },
            {
              "id": "0bea3995-0ca9-49d0-94f3-ed09b5d7f413",
              "v": "={{ $json.whatsapp_group_id }}",
              "operator": "equal",
              "column": "={{ $('Extract Message Data').item.json.remoteJid }}"
            }
          ]
        },
        "fallbackSettings": {
          "fallbackMode": "unusedValue"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        900,
        600
      ],
      "id": "432501bb-8669-47d4-9669-607d665e8365",
      "name": "Router"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/complaints/summary",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1150,
        400
      ],
      "id": "0f5a626f-66ed-4408-9183-1a300790353f",
      "name": "Get Data for Manager",
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "=http://38.242.139.159:3005/api/checklist/?date_filter={{ new Date().toISOString().split('T')[0] }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1350,
        400
      ],
      "id": "2c2afa42-f564-49d6-abc4-ba24eb990176",
      "name": "Get Tasks for Manager",
      "continueOnFail": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Extract Message Data').item.json.message_text }}",
        "options": {
          "systemMessage": "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ù„Ù…Ø¯ÙŠØ±. Ø¨ØªØ¯ÙŠÙ„Ù‡ ØªÙ‚Ø§Ø±ÙŠØ± ÙˆÙ…Ù„Ø®ØµØ§Øª Ø¹Ù† Ø´ØºÙ„ Ø§Ù„ÙŠÙˆÙ….\n\n# Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰:\n{{ $('Get Data for Manager').first().json | stringify }}\n\n# Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…:\n{{ $('Get Tasks for Manager').first().json | stringify }}\n\n# Ù‚ÙˆØ§Ø¹Ø¯Ùƒ:\n- ÙƒÙ„Ø§Ù…Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ\n- Ù„Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ± Ø³Ø£Ù„ \"Ø¥ÙŠÙ‡ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ØŸ\" Ø£Ùˆ \"ÙÙŠÙ‡ Ø´ÙƒØ§ÙˆÙ‰ØŸ\" â†’ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„\n- Ù„Ùˆ Ø³Ø£Ù„ \"Ø¥ÙŠÙ‡ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ø§Ù…ØŸ\" â†’ Ø§Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‡Ø§Ù… (Ù…ÙƒØªÙ…Ù„Ø©/Ù…Ø¹Ù„Ù‚Ø©)\n- Ù„Ùˆ Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„ Ø¹Ø§Ù… â†’ Ø¬Ø§ÙˆØ¨Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©\n- ÙƒÙ† Ù…Ø®ØªØµØ± ÙˆÙ…Ø­ØªØ±Ù\n- Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ø´ÙƒÙ„ Ù…Ø¹ØªØ¯Ù„\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1550,
        400
      ],
      "id": "7adce796-4031-41c0-b17f-a31fcc449d22",
      "name": "Manager AI Agent"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
      "typeVersion": 1,
      "position": [
        1400,
        600
      ],
      "id": "161f0ac7-d617-43f5-9038-5ba156366090",
      "name": "Azure OpenAI (Manager)",
      "credentials": {
        "azureOpenAiApi": {
          "id": "dHqEdXN0XQ09LqJi",
          "name": "Azure OpenAI"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Message Data').item.json.instance }}",
        "remoteJid": "={{ $('Extract Message Data').item.json.remoteJid }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1800,
        400
      ],
      "id": "ea2ab432-fba5-45fc-a601-2c25371a62e4",
      "name": "Send Reply to Manager",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "url": "=http://38.242.139.159:3005/api/checklist/?date_filter={{ new Date().toISOString().split('T')[0] }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1150,
        800
      ],
      "id": "531ea88e-d441-43a8-9132-77d59127786b",
      "name": "Get Group Tasks",
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/complaints/summary",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1350,
        800
      ],
      "id": "c0dcae02-e860-4a2a-90bb-d86ec9b611d3",
      "name": "Get Group Complaints",
      "continueOnFail": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Extract Message Data').item.json.message_text }}",
        "options": {
          "systemMessage": "Ø£Ù†Øª Ù…ÙˆØ¸Ù Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª ØªØ´ØºÙŠÙ„ Ø°ÙƒÙŠ (AI Logistics Coordinator) ØªØ¹Ù…Ù„ ÙÙŠ Ø¬Ø±ÙˆØ¨ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠÙÙ†ØªØ§Øª.\n\n# Ø¯ÙˆØ±Ùƒ:\n1. **Ù…ØªØ§Ø¨Ø¹Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù…**: Ù„Ù…Ø§ Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ Ø¥Ù†Ù‡ Ø®Ù„Ù‘Øµ Ù…Ù‡Ù…Ø©ØŒ ØªØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù…Ù‡Ø§ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØªØ³Ø£Ù„Ù‡ \"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø£Ù†Ù‡ÙŠØª Ù…Ù‡Ù…Ø© [Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©]ØŸ\" ÙˆÙ„Ùˆ Ø£ÙƒØ¯ ØªØ¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡Ø§ Ø¹Ù„Ø§Ù…Ø© âœ…\n2. **Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰**: Ù„Ùˆ Ø­Ø¯ Ù‚Ø¯Ù‘Ù… Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ù…Ø´ÙƒÙ„Ø©ØŒ ØªØ³Ø¬Ù„Ù‡Ø§ ÙÙˆØ±Ø§Ù‹ ÙˆØªØµØ¹Ø¯Ù‡Ø§ Ù„Ù„Ù…Ø¯ÙŠØ±\n3. **Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª**: Ù„Ùˆ Ø­Ø¯ Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ù…Ù‡Ø§Ù… Ø£Ùˆ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ØªØ¬Ø§ÙˆØ¨Ù‡\n\n# Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ø§Ù„ÙŠÙˆÙ…:\n{{ $('Get Group Tasks').first().json | stringify }}\n\n# Ù…Ù„Ø®Øµ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰:\n{{ $('Get Group Complaints').first().json | stringify }}\n\n# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:\n{{ $('Get Routing Settings').first().json | stringify }}\n\n# Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù‡Ù…Ø©:\n- ÙƒÙ„Ø§Ù…Ùƒ ÙŠÙƒÙˆÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ\n- Ù„Ù…Ø§ Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ \"Ø®Ù„ØµØª\" Ø£Ùˆ \"Ø£Ù†Ù‡ÙŠØª\" Ø£Ùˆ \"ØªÙ…Øª\" Ù…Ø¹ Ø§Ø³Ù… Ù…Ù‡Ù…Ø© â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù‡Ù…Ø©\n- Ù„Ù…Ø§ ØªÙ„Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù‡Ù…Ø© â†’ Ø§Ø³Ø£Ù„ \"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø£Ù†Ù‡ÙŠØª Ù…Ù‡Ù…Ø© [Ø§Ù„Ø§Ø³Ù…]ØŸ\"\n- Ù„Ùˆ Ø£ÙƒØ¯ â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù…Ù‡Ù…Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø©\n- Ù„Ùˆ ÙÙŠÙ‡ Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ù…Ø´ÙƒÙ„Ø© â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰\n- ÙƒÙ† Ù…Ø­ØªØ±Ù ÙˆÙ…Ø®ØªØµØ± ÙÙŠ Ø±Ø¯ÙˆØ¯Ùƒ\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1550,
        800
      ],
      "id": "8530f154-0b0e-42e7-8471-935d1cb89553",
      "name": "Group AI Agent"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
      "typeVersion": 1,
      "position": [
        1400,
        1000
      ],
      "id": "e8184426-10ea-4a0d-919c-87c1d8e82aa9",
      "name": "Azure OpenAI (Group)",
      "credentials": {
        "azureOpenAiApi": {
          "id": "dHqEdXN0XQ09LqJi",
          "name": "Azure OpenAI"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ù…Ø© Ø¨Ø§Ù„Ø§Ø³Ù…. Ø£Ø±Ø³Ù„ task_name.",
        "method": "GET",
        "url": "=http://38.242.139.159:3005/api/checklist/search?task_name={{ $fromAI('task_name', '') }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1350,
        1200
      ],
      "id": "6550ff9c-fff3-4e23-ae31-fbc9e23452b8",
      "name": "Search Task Tool"
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„ØªØ¹Ù„ÙŠÙ… Ù…Ù‡Ù…Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø©. Ø£Ø±Ø³Ù„ task_id.",
        "method": "PUT",
        "url": "=http://38.242.139.159:3005/api/checklist/{{ $fromAI('task_id', '') }}/toggle",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"is_completed\": true,\n  \"completed_by_phone\": \"{{ $('Extract Message Data').item.json.sender_phone }}\",\n  \"completed_by_name\": \"{{ $('Extract Message Data').item.json.sender_name }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1550,
        1200
      ],
      "id": "fd1b94f1-96d4-4142-b610-36a8e83ad91c",
      "name": "Complete Task Tool"
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰. Ø£Ø±Ø³Ù„ complaint_text.",
        "method": "POST",
        "url": "http://38.242.139.159:3005/api/complaints/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reporter_phone\": \"{{ $('Extract Message Data').item.json.sender_phone }}\",\n  \"reporter_name\": \"{{ $('Extract Message Data').item.json.sender_name }}\",\n  \"complaint_text\": \"{{ $fromAI('complaint_text', '') }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1750,
        1200
      ],
      "id": "06e09bd9-70ee-4c29-a5fa-5ba403d567a9",
      "name": "Register Complaint Tool"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Message Data').item.json.instance }}",
        "remoteJid": "={{ $('Extract Message Data').item.json.remoteJid }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1800,
        800
      ],
      "id": "3e5c28ee-61c4-4f10-980f-bf65d3f52235",
      "name": "Send Reply to Group",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "04098d11-aa49-4456-829d-fd8d602a707e",
              "leftValue": "={{ $json.output }}",
              "rightValue": "Ø´ÙƒÙˆÙ‰",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2000,
        800
      ],
      "id": "52e6e8af-b3c0-441e-b46c-2b5962990b6c",
      "name": "Has Complaint?"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Message Data').item.json.instance }}",
        "remoteJid": "={{ $('Get Routing Settings').item.json.manager_phone + '@s.whatsapp.net' }}",
        "messageText": "=ğŸ”º *Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©!*\n\nğŸ‘¤ Ù…Ù†: {{ $('Extract Message Data').item.json.sender_name }}\nğŸ“± Ø±Ù‚Ù…: {{ $('Extract Message Data').item.json.sender_phone }}\n\nğŸ’¬ {{ $('Extract Message Data').item.json.message_text }}\n\nâ° {{ new Date().toLocaleString('ar-EG', {timeZone: 'Africa/Cairo'}) }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        2200,
        700
      ],
      "id": "8528ad92-d469-44c1-b781-10f3195cd059",
      "name": "Escalate to Manager",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "43508341-32ff-42c1-827f-088b5301bfd7",
              "leftValue": "={{ $json.is_group }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1150,
        1200
      ],
      "id": "7ee399ec-56fa-420b-83b5-d1e9baf21da3",
      "name": "Is Individual Client?"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1400,
        1200
      ],
      "id": "0d481ad1-2f5a-413d-9180-d4ea2d400c6f",
      "name": "Manual Client Handling"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 1
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        1600
      ],
      "id": "04c9bef9-a811-405d-82ab-39e27901ac07",
      "name": "Every Minute Trigger"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/agenda/upcoming?minutes=10",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        200,
        1600
      ],
      "id": "aa538711-d687-49b3-a150-615670cc4e73",
      "name": "Check Upcoming Events",
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "72c2c471-0a63-4a56-97cf-4ea81861766f",
              "leftValue": "={{ $json.count }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        400,
        1600
      ],
      "id": "3a511c96-9f9b-4f36-89aa-d606117c291e",
      "name": "Has Upcoming Events?"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/checklist/settings",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        600,
        1500
      ],
      "id": "1a5bc7bf-8684-4a0f-b1ec-f9530818d366",
      "name": "Get Settings for Reminder",
      "continueOnFail": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "={{ $('Check Upcoming Events').first().json.upcoming }}",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        800,
        1500
      ],
      "id": "c7b79b06-2d51-4a29-b436-1643cc4e3741",
      "name": "Split Events"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "Mahmoud Magdy",
        "remoteJid": "={{ $('Get Settings for Reminder').first().json.whatsapp_group_id }}",
        "messageText": "=â° *ØªØ°ÙƒÙŠØ±!*\n\nğŸ“Œ Ø¨Ø§Ù‚ÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù„Ù‰:\n\nğŸ¯ *{{ $json.title }}*\nğŸ“ Ø§Ù„Ù…ÙƒØ§Ù†: {{ $json.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}\nğŸ• Ø§Ù„ÙˆÙ‚Øª: {{ new Date($json.event_time).toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit', timeZone: 'Africa/Cairo'}) }}\n{{ $json.description ? '\\nğŸ“ ' + $json.description : '' }}\n\nØ§Ø³ØªØ¹Ø¯ÙˆØ§! ğŸš€",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1000,
        1500
      ],
      "id": "8e61b057-2b09-4dbe-9eaf-429c6d4b7925",
      "name": "Send Reminder to Group",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=http://38.242.139.159:3005/api/agenda/{{ $json.id }}/reminder-sent",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1200,
        1500
      ],
      "id": "3151314d-16d7-43cf-b4e9-d8244d2baa0a",
      "name": "Mark Reminder Sent"
    }
  ],
  "connections": {
    "Whatsapp": {
      "main": [
        [
          {
            "node": "Extract Message Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Message Data": {
      "main": [
        [
          {
            "node": "Is Not Empty?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Not Empty?": {
      "main": [
        [
          {
            "node": "Get Routing Settings",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Routing Settings": {
      "main": [
        [
          {
            "node": "Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Data for Manager": {
      "main": [
        [
          {
            "node": "Get Tasks for Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tasks for Manager": {
      "main": [
        [
          {
            "node": "Manager AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Azure OpenAI (Manager)": {
      "ai_languageModel": [
        [
          {
            "node": "Manager AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Manager AI Agent": {
      "main": [
        [
          {
            "node": "Send Reply to Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Group Tasks": {
      "main": [
        [
          {
            "node": "Get Group Complaints",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Group Complaints": {
      "main": [
        [
          {
            "node": "Group AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Azure OpenAI (Group)": {
      "ai_languageModel": [
        [
          {
            "node": "Group AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Search Task Tool": {
      "ai_tool": [
        [
          {
            "node": "Group AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Complete Task Tool": {
      "ai_tool": [
        [
          {
            "node": "Group AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Register Complaint Tool": {
      "ai_tool": [
        [
          {
            "node": "Group AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Group AI Agent": {
      "main": [
        [
          {
            "node": "Send Reply to Group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Reply to Group": {
      "main": [
        [
          {
            "node": "Has Complaint?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Complaint?": {
      "main": [
        [
          {
            "node": "Escalate to Manager",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Is Individual Client?": {
      "main": [
        [
          {
            "node": "Manual Client Handling",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Router": {
      "main": [
        [
          {
            "node": "Get Data for Manager",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Group Tasks",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is Individual Client?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Every Minute Trigger": {
      "main": [
        [
          {
            "node": "Check Upcoming Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Upcoming Events": {
      "main": [
        [
          {
            "node": "Has Upcoming Events?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Upcoming Events?": {
      "main": [
        [
          {
            "node": "Get Settings for Reminder",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Settings for Reminder": {
      "main": [
        [
          {
            "node": "Split Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Events": {
      "main": [
        [
          {
            "node": "Send Reminder to Group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Reminder to Group": {
      "main": [
        [
          {
            "node": "Mark Reminder Sent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ca0c90b4-edc5-4cb4-b785-83b71061a9fe"
  }
}