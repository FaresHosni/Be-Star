{
  "name": "AI Logistics Coordinator - Ù…ÙˆØ¸Ù Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "logistics-group-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        300
      ],
      "id": "4f401402-0dd9-40d2-9f8d-0ecf024130d7",
      "name": "WhatsApp Group Webhook",
      "webhookId": "4869c983-7a44-4e33-9916-7369348ec71d"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"sender_phone\": \"{{ $json.body.data.key.participant || $json.body.data.key.remoteJid }}\",\n  \"sender_name\": \"{{ $json.body.data.pushName || 'Ù…Ø¬Ù‡ÙˆÙ„' }}\",\n  \"message_text\": \"{{ $json.body.data.message.conversation || $json.body.data.message.extendedTextMessage?.text || '' }}\",\n  \"group_id\": \"{{ $json.body.data.key.remoteJid }}\",\n  \"instance\": \"{{ $json.body.instance }}\",\n  \"is_group\": {{ $json.body.data.key.remoteJid?.includes(\"@g.us\") || false }}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        240,
        300
      ],
      "id": "a5b85b34-9a86-44e6-b7f1-7bf8bc7c4045",
      "name": "Extract Message Data"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ff609961-f508-4dfd-b705-63768dfe2cd0",
              "leftValue": "={{ $json.is_group }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            },
            {
              "id": "b44c0693-a064-4e43-a194-6d4711389aef",
              "leftValue": "={{ $json.message_text }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        480,
        300
      ],
      "id": "149b7cff-5e70-4fd7-9d6d-05f45cff9c81",
      "name": "Is Group Message?"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/checklist/settings",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        720,
        200
      ],
      "id": "53f100d6-fcc9-48c1-aa54-16a107fa5f82",
      "name": "Get Logistics Settings",
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "1a7b1420-9c59-40a0-81cb-1f27e9843a1f",
              "leftValue": "={{ $json.whatsapp_group_id }}",
              "rightValue": "={{ $('Extract Message Data').item.json.group_id }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        960,
        200
      ],
      "id": "6e399048-9e6f-4d94-9adc-d0ff9eb7c003",
      "name": "Is Correct Group?"
    },
    {
      "parameters": {
        "url": "=http://38.242.139.159:3005/api/checklist/?date_filter={{ new Date().toISOString().split('T')[0] }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        960,
        200
      ],
      "id": "82d2743b-1681-4ee9-99fa-47092226415e",
      "name": "Get Today Tasks",
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/complaints/summary",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        960,
        400
      ],
      "id": "e53fca8b-e2fb-4e4c-80eb-29ccf284df9e",
      "name": "Get Complaints Summary",
      "continueOnFail": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Extract Message Data').first().json.message_text }}",
        "options": {
          "systemMessage": "Ø£Ù†Øª Ù…ÙˆØ¸Ù Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª ØªØ´ØºÙŠÙ„ Ø°ÙƒÙŠ (AI Logistics Coordinator) ØªØ¹Ù…Ù„ ÙÙŠ Ø¬Ø±ÙˆØ¨ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠÙÙ†ØªØ§Øª.\n\n# Ø¯ÙˆØ±Ùƒ:\n1. **Ù…ØªØ§Ø¨Ø¹Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù…**: Ù„Ù…Ø§ Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ Ø¥Ù†Ù‡ Ø®Ù„Ù‘Øµ Ù…Ù‡Ù…Ø©ØŒ ØªØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù…Ù‡Ø§ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØªØ³Ø£Ù„Ù‡ \"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø£Ù†Ù‡ÙŠØª Ù…Ù‡Ù…Ø© [Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©]ØŸ\" ÙˆÙ„Ùˆ Ø£ÙƒØ¯ ØªØ¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡Ø§ Ø¹Ù„Ø§Ù…Ø© âœ…\n2. **Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰**: Ù„Ùˆ Ø­Ø¯ Ù‚Ø¯Ù‘Ù… Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ù…Ø´ÙƒÙ„Ø©ØŒ ØªØ³Ø¬Ù„Ù‡Ø§ ÙÙˆØ±Ø§Ù‹ ÙˆØªØµØ¹Ø¯Ù‡Ø§ Ù„Ù„Ù…Ø¯ÙŠØ±\n3. **Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª**: Ù„Ùˆ Ø­Ø¯ Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ù…Ù‡Ø§Ù… Ø£Ùˆ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ØªØ¬Ø§ÙˆØ¨Ù‡\n\n# Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ø§Ù„ÙŠÙˆÙ…:\n{{ $('Get Today Tasks').first().json | stringify }}\n\n# Ù…Ù„Ø®Øµ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰:\n{{ $('Get Complaints Summary').first().json | stringify }}\n\n# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:\n{{ $('Get Logistics Settings').first().json | stringify }}\n\n# Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù‡Ù…Ø©:\n- ÙƒÙ„Ø§Ù…Ùƒ ÙŠÙƒÙˆÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ\n- Ù„Ù…Ø§ Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ \"Ø®Ù„ØµØª\" Ø£Ùˆ \"Ø£Ù†Ù‡ÙŠØª\" Ø£Ùˆ \"ØªÙ…Øª\" Ù…Ø¹ Ø§Ø³Ù… Ù…Ù‡Ù…Ø© â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù‡Ù…Ø©\n- Ù„Ù…Ø§ ØªÙ„Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù‡Ù…Ø© â†’ Ø§Ø³Ø£Ù„ \"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø£Ù†Ù‡ÙŠØª Ù…Ù‡Ù…Ø© [Ø§Ù„Ø§Ø³Ù…]ØŸ\"\n- Ù„Ùˆ Ø£ÙƒØ¯ â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù…Ù‡Ù…Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø©\n- Ù„Ùˆ ÙÙŠÙ‡ Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ù…Ø´ÙƒÙ„Ø© â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰\n- ÙƒÙ† Ù…Ø­ØªØ±Ù ÙˆÙ…Ø®ØªØµØ± ÙÙŠ Ø±Ø¯ÙˆØ¯Ùƒ\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1200,
        300
      ],
      "id": "c750e4a0-a75d-4e54-b041-3b77c9043133",
      "name": "Logistics AI Agent"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
      "typeVersion": 1,
      "position": [
        1100,
        520
      ],
      "id": "e5aa80e1-c430-4e9b-b8a7-d05f6618dcf2",
      "name": "Azure OpenAI (Logistics)",
      "credentials": {
        "azureOpenAiApi": {
          "id": "dHqEdXN0XQ09LqJi",
          "name": "Azure OpenAI"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ù…Ø© Ø¨Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…. Ø£Ø±Ø³Ù„ task_name (Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ø£Ùˆ Ø¬Ø²Ø¡ Ù…Ù†Ù‡).",
        "method": "GET",
        "url": "=http://38.242.139.159:3005/api/checklist/search?task_name={{ $fromAI('task_name', '') }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1000,
        680
      ],
      "id": "39440a67-7899-498e-af2f-b9f6374a689c",
      "name": "Search Task Tool"
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„ØªØ¹Ù„ÙŠÙ… Ù…Ù‡Ù…Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø© Ø¨Ø¹Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„. Ø£Ø±Ø³Ù„ task_id (Ø±Ù‚Ù… Ø§Ù„Ù…Ù‡Ù…Ø©).",
        "method": "PUT",
        "url": "=http://38.242.139.159:3005/api/checklist/{{ $fromAI('task_id', '') }}/toggle",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"is_completed\": true,\n  \"completed_by_phone\": \"{{ $('Extract Message Data').first().json.sender_phone }}\",\n  \"completed_by_name\": \"{{ $('Extract Message Data').first().json.sender_name }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1200,
        680
      ],
      "id": "12b69b0d-73fe-450d-b05a-bb70a078557f",
      "name": "Complete Task Tool"
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø¹Ù…ÙŠÙ„. Ø£Ø±Ø³Ù„ complaint_text (Ù†Øµ Ø§Ù„Ø´ÙƒÙˆÙ‰).",
        "method": "POST",
        "url": "http://38.242.139.159:3005/api/complaints/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reporter_phone\": \"{{ $('Extract Message Data').first().json.sender_phone }}\",\n  \"reporter_name\": \"{{ $('Extract Message Data').first().json.sender_name }}\",\n  \"complaint_text\": \"{{ $fromAI('complaint_text', '') }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1400,
        680
      ],
      "id": "e4ea0cd7-cad6-4fba-ae14-a046bb8dc5ba",
      "name": "Register Complaint Tool"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Message Data').first().json.instance }}",
        "remoteJid": "={{ $('Extract Message Data').first().json.group_id }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1500,
        300
      ],
      "id": "4348a28c-7f10-4304-9478-7dc2273e749a",
      "name": "Send AI Reply to Group",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "70e83cf7-9b33-4d72-a6bd-5930bcb4b053",
              "leftValue": "={{ $json.output }}",
              "rightValue": "Ø´ÙƒÙˆÙ‰",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1740,
        300
      ],
      "id": "78d85c7f-6c97-49a8-bc0b-cb117f74e915",
      "name": "Has Complaint?"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Message Data').first().json.instance }}",
        "remoteJid": "={{ $('Get Logistics Settings').first().json.manager_phone + '@s.whatsapp.net' }}",
        "messageText": "=ğŸ”º *Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©!*\n\nğŸ‘¤ Ù…Ù†: {{ $('Extract Message Data').first().json.sender_name }}\nğŸ“± Ø±Ù‚Ù…: {{ $('Extract Message Data').first().json.sender_phone }}\n\nğŸ’¬ {{ $('Extract Message Data').first().json.message_text }}\n\nâ° {{ new Date().toLocaleString('ar-EG', {timeZone: 'Africa/Cairo'}) }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1980,
        200
      ],
      "id": "e6d5bd40-2dff-4796-8a4f-a879204fd9b0",
      "name": "Escalate to Manager",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 1
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        800
      ],
      "id": "4db2d219-6589-4d01-8d7b-e84021c0106a",
      "name": "Every Minute Trigger"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/agenda/upcoming?minutes=10",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        240,
        800
      ],
      "id": "6618afe5-75cd-45a5-a219-4a742d533e01",
      "name": "Check Upcoming Events",
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7d3179c5-5086-4259-9c1b-96d761168b8c",
              "leftValue": "={{ $json.count }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        480,
        800
      ],
      "id": "2467bff8-d24d-4a1a-a706-2768f5647dcc",
      "name": "Has Upcoming Events?"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/checklist/settings",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        720,
        700
      ],
      "id": "8079cda8-4ef7-4528-adb4-9ede5849c1ad",
      "name": "Get Settings for Reminder",
      "continueOnFail": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "={{ $('Check Upcoming Events').first().json.upcoming }}",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        960,
        700
      ],
      "id": "91267901-aca3-4078-bed4-abedfc5c4400",
      "name": "Split Events"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('WhatsApp Group Webhook').first().json.body?.instance || 'default' }}",
        "remoteJid": "={{ $('Get Settings for Reminder').first().json.whatsapp_group_id }}",
        "messageText": "=â° *ØªØ°ÙƒÙŠØ±!*\n\nğŸ“Œ Ø¨Ø§Ù‚ÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù„Ù‰:\n\nğŸ¯ *{{ $json.title }}*\nğŸ“ Ø§Ù„Ù…ÙƒØ§Ù†: {{ $json.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}\nğŸ• Ø§Ù„ÙˆÙ‚Øª: {{ new Date($json.event_time).toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit', timeZone: 'Africa/Cairo'}) }}\n{{ $json.description ? '\\nğŸ“ ' + $json.description : '' }}\n\nØ§Ø³ØªØ¹Ø¯ÙˆØ§! ğŸš€",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1200,
        700
      ],
      "id": "25ba50d2-6167-48a8-a002-b63b2d0ef34d",
      "name": "Send Reminder to Group",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=http://38.242.139.159:3005/api/agenda/{{ $json.id }}/reminder-sent",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1440,
        700
      ],
      "id": "810f2fae-c829-4503-a127-3c23a0d7a891",
      "name": "Mark Reminder Sent"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "logistics-manager-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        1300
      ],
      "id": "ad1efffd-0297-4da4-a156-7085cf881844",
      "name": "Manager WhatsApp Webhook",
      "webhookId": "fc4c8cd8-74e0-42bb-8b30-f109bef29f20"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"manager_phone\": \"{{ $json.body.data.key.remoteJid }}\",\n  \"message_text\": \"{{ $json.body.data.message.conversation || $json.body.data.message.extendedTextMessage?.text || '' }}\",\n  \"instance\": \"{{ $json.body.instance }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        240,
        1300
      ],
      "id": "f3871de3-da68-4119-aaec-a9ac88c2eab2",
      "name": "Extract Manager Message"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/checklist/settings",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        480,
        1300
      ],
      "id": "f1147f5c-bfee-41a5-b5f1-c67c3c2c10c5",
      "name": "Get Manager Settings",
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c357a4fc-53da-4a40-964a-cd5c791f94f2",
              "leftValue": "={{ $json.manager_phone + '@s.whatsapp.net' }}",
              "rightValue": "={{ $('Extract Manager Message').item.json.manager_phone }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        720,
        1300
      ],
      "id": "e3bc4dc1-b19f-4f5e-8854-b30c09897c7f",
      "name": "Is Manager?"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/complaints/summary",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        960,
        1300
      ],
      "id": "9c50d58a-2ef3-4aa1-a2c5-8dc7b6caf838",
      "name": "Get Data for Manager",
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "=http://38.242.139.159:3005/api/checklist/?date_filter={{ new Date().toISOString().split('T')[0] }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        720,
        1300
      ],
      "id": "e5e3903d-5a42-4bb0-9ab0-10f54c515184",
      "name": "Get Tasks for Manager",
      "continueOnFail": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Extract Manager Message').first().json.message_text }}",
        "options": {
          "systemMessage": "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ù„Ù…Ø¯ÙŠØ±. Ø¨ØªØ¯ÙŠÙ„Ù‡ ØªÙ‚Ø§Ø±ÙŠØ± ÙˆÙ…Ù„Ø®ØµØ§Øª Ø¹Ù† Ø´ØºÙ„ Ø§Ù„ÙŠÙˆÙ….\n\n# Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰:\n{{ $('Get Data for Manager').first().json | stringify }}\n\n# Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…:\n{{ $('Get Tasks for Manager').first().json | stringify }}\n\n# Ù‚ÙˆØ§Ø¹Ø¯Ùƒ:\n- ÙƒÙ„Ø§Ù…Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ\n- Ù„Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ± Ø³Ø£Ù„ \"Ø¥ÙŠÙ‡ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ØŸ\" Ø£Ùˆ \"ÙÙŠÙ‡ Ø´ÙƒØ§ÙˆÙ‰ØŸ\" â†’ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„\n- Ù„Ùˆ Ø³Ø£Ù„ \"Ø¥ÙŠÙ‡ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ø§Ù…ØŸ\" â†’ Ø§Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‡Ø§Ù… (Ù…ÙƒØªÙ…Ù„Ø©/Ù…Ø¹Ù„Ù‚Ø©)\n- Ù„Ùˆ Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„ Ø¹Ø§Ù… â†’ Ø¬Ø§ÙˆØ¨Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©\n- ÙƒÙ† Ù…Ø®ØªØµØ± ÙˆÙ…Ø­ØªØ±Ù\n- Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ø´ÙƒÙ„ Ù…Ø¹ØªØ¯Ù„\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        960,
        1300
      ],
      "id": "80fa80f9-a63e-4423-9980-631ea6933478",
      "name": "Manager AI Agent"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
      "typeVersion": 1,
      "position": [
        860,
        1520
      ],
      "id": "dabe0a02-648a-403f-970a-6820753beea8",
      "name": "Azure OpenAI (Manager)",
      "credentials": {
        "azureOpenAiApi": {
          "id": "dHqEdXN0XQ09LqJi",
          "name": "Azure OpenAI"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Manager Message').first().json.instance }}",
        "remoteJid": "={{ $('Extract Manager Message').first().json.manager_phone }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1200,
        1300
      ],
      "id": "0271e6fc-2d84-4a07-a563-a862baf35b38",
      "name": "Send Reply to Manager",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "content": "# ğŸ“‹ Ø¬Ø±ÙˆØ¨ ÙˆØ§ØªØ³Ø§Ø¨ - Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰\nÙŠØ³ØªÙ‚Ø¨Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø±ÙˆØ¨ â†’ ÙŠØµÙ†Ù Ø§Ù„Ù†ÙŠØ© â†’ ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù‡Ø§Ù… â†’ ÙŠØ³Ø¬Ù„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -100,
        100
      ],
      "id": "8294b89e-0be9-4f7a-a2d1-aea91ac53f67",
      "name": "Sticky Note 1"
    },
    {
      "parameters": {
        "content": "# â° Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©\nÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© â†’ ÙŠØ¨Ø¹Øª ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ 10 Ø¯Ù‚Ø§Ø¦Ù‚"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -100,
        650
      ],
      "id": "2c382ef3-6156-4a4e-afa3-98b7c1cc75a9",
      "name": "Sticky Note 2"
    },
    {
      "parameters": {
        "content": "# ğŸ‘” Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø®Ø§ØµØ©\nØ§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ‚Ø¯Ø± ÙŠØ³Ø£Ù„ Ø¹Ù† Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ù…Ù‡Ø§Ù… ÙˆÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ø®ØµØ§Øª"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -100,
        1150
      ],
      "id": "397af839-55f1-41f8-b18e-2c693c080d42",
      "name": "Sticky Note 3"
    }
  ],
  "connections": {
    "WhatsApp Group Webhook": {
      "main": [
        [
          {
            "node": "Extract Message Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Message Data": {
      "main": [
        [
          {
            "node": "Is Group Message?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Group Message?": {
      "main": [
        [
          {
            "node": "Get Logistics Settings",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Logistics Settings": {
      "main": [
        [
          {
            "node": "Is Correct Group?",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Is Correct Group?": {
      "main": [
        [
          {
            "node": "Get Today Tasks",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Today Tasks": {
      "main": [
        [
          {
            "node": "Get Complaints Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Complaints Summary": {
      "main": [
        [
          {
            "node": "Logistics AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Azure OpenAI (Logistics)": {
      "ai_languageModel": [
        [
          {
            "node": "Logistics AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Search Task Tool": {
      "ai_tool": [
        [
          {
            "node": "Logistics AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Complete Task Tool": {
      "ai_tool": [
        [
          {
            "node": "Logistics AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Register Complaint Tool": {
      "ai_tool": [
        [
          {
            "node": "Logistics AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Logistics AI Agent": {
      "main": [
        [
          {
            "node": "Send AI Reply to Group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send AI Reply to Group": {
      "main": [
        [
          {
            "node": "Has Complaint?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Complaint?": {
      "main": [
        [
          {
            "node": "Escalate to Manager",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Every Minute Trigger": {
      "main": [
        [
          {
            "node": "Check Upcoming Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Upcoming Events": {
      "main": [
        [
          {
            "node": "Has Upcoming Events?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Upcoming Events?": {
      "main": [
        [
          {
            "node": "Get Settings for Reminder",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Settings for Reminder": {
      "main": [
        [
          {
            "node": "Split Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Events": {
      "main": [
        [
          {
            "node": "Send Reminder to Group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Reminder to Group": {
      "main": [
        [
          {
            "node": "Mark Reminder Sent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manager WhatsApp Webhook": {
      "main": [
        [
          {
            "node": "Extract Manager Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Manager Message": {
      "main": [
        [
          {
            "node": "Get Manager Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Manager Settings": {
      "main": [
        [
          {
            "node": "Is Manager?",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Is Manager?": {
      "main": [
        [
          {
            "node": "Get Data for Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Data for Manager": {
      "main": [
        [
          {
            "node": "Get Tasks for Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tasks for Manager": {
      "main": [
        [
          {
            "node": "Manager AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Azure OpenAI (Manager)": {
      "ai_languageModel": [
        [
          {
            "node": "Manager AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Manager AI Agent": {
      "main": [
        [
          {
            "node": "Send Reply to Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "c5f07632-5632-4682-9d48-a3539d33a3c8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "8df4082ac81111d2321c538ef34013493a96dd3b14b3af10e13ce9c3849e34d3"
  },
  "tags": [
    {
      "name": "logistics"
    },
    {
      "name": "be-star"
    }
  ]
}