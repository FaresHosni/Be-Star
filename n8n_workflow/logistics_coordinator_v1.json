{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "bestar-whatsapp",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        600
      ],
      "id": "9cd98322-3631-4b11-9f3d-054499ee964c",
      "name": "Whatsapp",
      "webhookId": "d8fa5154-f391-43c2-ad0c-f5c7b3eb2737"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"remoteJid\": \"{{ $json.body.data.key.remoteJid }}\",\n  \"sender_phone\": \"{{ $json.body.data.key.participant || $json.body.data.key.remoteJid }}\",\n  \"sender_name\": \"{{ $json.body.data.pushName || 'Ù…Ø¬Ù‡ÙˆÙ„' }}\",\n  \"message_text\": \"{{ $json.body.data.message.conversation || $json.body.data.message.extendedTextMessage?.text || '' }}\",\n  \"instance\": \"{{ $json.body.instance }}\",\n  \"is_group\": {{ $json.body.data.key.remoteJid?.includes(\"@g.us\") || false }}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        240,
        600
      ],
      "id": "c9fe0be1-b36f-4620-a57f-4d863075c996",
      "name": "Extract Message Data"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "37e979b3-0682-4e38-b87a-36aa0901c3f0",
              "leftValue": "={{ $json.message_text }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        460,
        600
      ],
      "id": "ba6d63ee-58dd-41f5-a674-de0005dcc179",
      "name": "Is Not Empty?"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/checklist/settings",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        680,
        600
      ],
      "id": "4fbdd9ad-1b88-487b-9880-644973a54e57",
      "name": "Get Routing Settings",
      "continueOnFail": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "id": "2a781d4c-92ae-4c11-bc3e-e2d5e30dbd33",
              "v": "={{ $json.manager_phone + '@s.whatsapp.net' }}",
              "operator": "equal",
              "column": "={{ $('Extract Message Data').item.json.remoteJid }}"
            },
            {
              "id": "1cf81fa4-2827-4ab6-800a-7d2ef80625e5",
              "v": "={{ $json.whatsapp_group_id }}",
              "operator": "equal",
              "column": "={{ $('Extract Message Data').item.json.remoteJid }}"
            }
          ]
        },
        "fallbackSettings": {
          "fallbackMode": "unusedValue"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        900,
        600
      ],
      "id": "1588c4c5-5902-4cb7-90a1-d1a4246f80ad",
      "name": "Router"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/complaints/summary",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1150,
        400
      ],
      "id": "aeadffea-6719-4c0b-a88d-1511a593186b",
      "name": "Get Data for Manager",
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "=http://38.242.139.159:3005/api/checklist/?date_filter={{ new Date().toISOString().split('T')[0] }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1350,
        400
      ],
      "id": "294d1679-e223-44f0-9d29-86cbc45960b1",
      "name": "Get Tasks for Manager",
      "continueOnFail": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Extract Message Data').item.json.message_text }}",
        "options": {
          "systemMessage": "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ù„Ù…Ø¯ÙŠØ±. Ø¨ØªØ¯ÙŠÙ„Ù‡ ØªÙ‚Ø§Ø±ÙŠØ± ÙˆÙ…Ù„Ø®ØµØ§Øª Ø¹Ù† Ø´ØºÙ„ Ø§Ù„ÙŠÙˆÙ….\n\n# Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰:\n{{ $('Get Data for Manager').first().json | stringify }}\n\n# Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…:\n{{ $('Get Tasks for Manager').first().json | stringify }}\n\n# Ù‚ÙˆØ§Ø¹Ø¯Ùƒ:\n- ÙƒÙ„Ø§Ù…Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ\n- Ù„Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ± Ø³Ø£Ù„ \"Ø¥ÙŠÙ‡ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ØŸ\" Ø£Ùˆ \"ÙÙŠÙ‡ Ø´ÙƒØ§ÙˆÙ‰ØŸ\" â†’ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„\n- Ù„Ùˆ Ø³Ø£Ù„ \"Ø¥ÙŠÙ‡ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ø§Ù…ØŸ\" â†’ Ø§Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‡Ø§Ù… (Ù…ÙƒØªÙ…Ù„Ø©/Ù…Ø¹Ù„Ù‚Ø©)\n- Ù„Ùˆ Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„ Ø¹Ø§Ù… â†’ Ø¬Ø§ÙˆØ¨Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©\n- ÙƒÙ† Ù…Ø®ØªØµØ± ÙˆÙ…Ø­ØªØ±Ù\n- Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ø´ÙƒÙ„ Ù…Ø¹ØªØ¯Ù„\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1550,
        400
      ],
      "id": "e15d117d-b146-4c16-ae28-421fe63e8b3c",
      "name": "Manager AI Agent"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
      "typeVersion": 1,
      "position": [
        1400,
        600
      ],
      "id": "5f25f12a-7012-40e0-8fbc-e85b0d2e2d50",
      "name": "Azure OpenAI (Manager)",
      "credentials": {
        "azureOpenAiApi": {
          "id": "dHqEdXN0XQ09LqJi",
          "name": "Azure OpenAI"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Message Data').item.json.instance }}",
        "remoteJid": "={{ $('Extract Message Data').item.json.remoteJid }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1800,
        400
      ],
      "id": "da2ca2a3-9f04-463a-899d-2be87568a7b6",
      "name": "Send Reply to Manager",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "url": "=http://38.242.139.159:3005/api/checklist/?date_filter={{ new Date().toISOString().split('T')[0] }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1150,
        800
      ],
      "id": "a206483b-4bf8-48ba-908c-0177d35d5a2d",
      "name": "Get Group Tasks",
      "continueOnFail": true
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/complaints/summary",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1350,
        800
      ],
      "id": "2f424afb-b2ae-4372-af02-ce38c7a3aecb",
      "name": "Get Group Complaints",
      "continueOnFail": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Extract Message Data').item.json.message_text }}",
        "options": {
          "systemMessage": "Ø£Ù†Øª Ù…ÙˆØ¸Ù Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª ØªØ´ØºÙŠÙ„ Ø°ÙƒÙŠ (AI Logistics Coordinator) ØªØ¹Ù…Ù„ ÙÙŠ Ø¬Ø±ÙˆØ¨ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠÙÙ†ØªØ§Øª.\n\n# Ø¯ÙˆØ±Ùƒ:\n1. **Ù…ØªØ§Ø¨Ø¹Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù…**: Ù„Ù…Ø§ Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ Ø¥Ù†Ù‡ Ø®Ù„Ù‘Øµ Ù…Ù‡Ù…Ø©ØŒ ØªØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù…Ù‡Ø§ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØªØ³Ø£Ù„Ù‡ \"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø£Ù†Ù‡ÙŠØª Ù…Ù‡Ù…Ø© [Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©]ØŸ\" ÙˆÙ„Ùˆ Ø£ÙƒØ¯ ØªØ¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡Ø§ Ø¹Ù„Ø§Ù…Ø© âœ…\n2. **Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰**: Ù„Ùˆ Ø­Ø¯ Ù‚Ø¯Ù‘Ù… Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ù…Ø´ÙƒÙ„Ø©ØŒ ØªØ³Ø¬Ù„Ù‡Ø§ ÙÙˆØ±Ø§Ù‹ ÙˆØªØµØ¹Ø¯Ù‡Ø§ Ù„Ù„Ù…Ø¯ÙŠØ±\n3. **Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª**: Ù„Ùˆ Ø­Ø¯ Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ù…Ù‡Ø§Ù… Ø£Ùˆ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ØªØ¬Ø§ÙˆØ¨Ù‡\n\n# Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ø§Ù„ÙŠÙˆÙ…:\n{{ $('Get Group Tasks').first().json | stringify }}\n\n# Ù…Ù„Ø®Øµ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰:\n{{ $('Get Group Complaints').first().json | stringify }}\n\n# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:\n{{ $('Get Routing Settings').first().json | stringify }}\n\n# Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù‡Ù…Ø©:\n- ÙƒÙ„Ø§Ù…Ùƒ ÙŠÙƒÙˆÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ\n- Ù„Ù…Ø§ Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ \"Ø®Ù„ØµØª\" Ø£Ùˆ \"Ø£Ù†Ù‡ÙŠØª\" Ø£Ùˆ \"ØªÙ…Øª\" Ù…Ø¹ Ø§Ø³Ù… Ù…Ù‡Ù…Ø© â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù‡Ù…Ø©\n- Ù„Ù…Ø§ ØªÙ„Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù‡Ù…Ø© â†’ Ø§Ø³Ø£Ù„ \"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø£Ù†Ù‡ÙŠØª Ù…Ù‡Ù…Ø© [Ø§Ù„Ø§Ø³Ù…]ØŸ\"\n- Ù„Ùˆ Ø£ÙƒØ¯ â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù…Ù‡Ù…Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø©\n- Ù„Ùˆ ÙÙŠÙ‡ Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ù…Ø´ÙƒÙ„Ø© â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰\n- ÙƒÙ† Ù…Ø­ØªØ±Ù ÙˆÙ…Ø®ØªØµØ± ÙÙŠ Ø±Ø¯ÙˆØ¯Ùƒ\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1550,
        800
      ],
      "id": "d705259e-5c89-4de1-be15-fdfc7e1dce5b",
      "name": "Group AI Agent"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
      "typeVersion": 1,
      "position": [
        1400,
        1000
      ],
      "id": "fabea958-47bc-46b6-a8b2-f948f2c3d464",
      "name": "Azure OpenAI (Group)",
      "credentials": {
        "azureOpenAiApi": {
          "id": "dHqEdXN0XQ09LqJi",
          "name": "Azure OpenAI"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ù…Ø© Ø¨Ø§Ù„Ø§Ø³Ù…. Ø£Ø±Ø³Ù„ task_name.",
        "method": "GET",
        "url": "=http://38.242.139.159:3005/api/checklist/search?task_name={{ $fromAI('task_name', '') }}",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1350,
        1200
      ],
      "id": "cfcd9361-1e22-40c9-9652-b8241934948e",
      "name": "Search Task Tool"
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„ØªØ¹Ù„ÙŠÙ… Ù…Ù‡Ù…Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø©. Ø£Ø±Ø³Ù„ task_id.",
        "method": "PUT",
        "url": "=http://38.242.139.159:3005/api/checklist/{{ $fromAI('task_id', '') }}/toggle",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"is_completed\": true,\n  \"completed_by_phone\": \"{{ $('Extract Message Data').item.json.sender_phone }}\",\n  \"completed_by_name\": \"{{ $('Extract Message Data').item.json.sender_name }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1550,
        1200
      ],
      "id": "f7f280f9-81a0-48bc-8116-09fafae7fee9",
      "name": "Complete Task Tool"
    },
    {
      "parameters": {
        "toolDescription": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰. Ø£Ø±Ø³Ù„ complaint_text.",
        "method": "POST",
        "url": "http://38.242.139.159:3005/api/complaints/",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reporter_phone\": \"{{ $('Extract Message Data').item.json.sender_phone }}\",\n  \"reporter_name\": \"{{ $('Extract Message Data').item.json.sender_name }}\",\n  \"complaint_text\": \"{{ $fromAI('complaint_text', '') }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1750,
        1200
      ],
      "id": "9389fc3d-2445-4c11-9324-f95685239386",
      "name": "Register Complaint Tool"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Message Data').item.json.instance }}",
        "remoteJid": "={{ $('Extract Message Data').item.json.remoteJid }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1800,
        800
      ],
      "id": "6266f0ab-88ee-456c-922f-74ecf24ade93",
      "name": "Send Reply to Group",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "d81c012e-6923-4447-98c7-4a45629d5c43",
              "leftValue": "={{ $json.output }}",
              "rightValue": "Ø´ÙƒÙˆÙ‰",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2000,
        800
      ],
      "id": "9a22a14f-0f61-408b-b850-0ce4ebf756bd",
      "name": "Has Complaint?"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Extract Message Data').item.json.instance }}",
        "remoteJid": "={{ $('Get Routing Settings').item.json.manager_phone + '@s.whatsapp.net' }}",
        "messageText": "=ğŸ”º *Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©!*\n\nğŸ‘¤ Ù…Ù†: {{ $('Extract Message Data').item.json.sender_name }}\nğŸ“± Ø±Ù‚Ù…: {{ $('Extract Message Data').item.json.sender_phone }}\n\nğŸ’¬ {{ $('Extract Message Data').item.json.message_text }}\n\nâ° {{ new Date().toLocaleString('ar-EG', {timeZone: 'Africa/Cairo'}) }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        2200,
        700
      ],
      "id": "64262a73-8107-4812-8f4c-c7b888b12cf5",
      "name": "Escalate to Manager",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1150,
        1200
      ],
      "id": "1c6cf839-bf51-4fe3-840c-109305f6a9be",
      "name": "Manual Client Handling"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 1
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        1600
      ],
      "id": "047e9c7d-570b-40bb-9d9e-c7dae107ac0f",
      "name": "Every Minute Trigger"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/agenda/upcoming?minutes=10",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        200,
        1600
      ],
      "id": "1219fcfa-eca5-44c5-b31e-da8486b300b3",
      "name": "Check Upcoming Events",
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5f6e25dc-c5a7-41a0-8da4-b851631d1195",
              "leftValue": "={{ $json.count }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        400,
        1600
      ],
      "id": "2b6648bb-c75c-442b-bd74-377f6761ce53",
      "name": "Has Upcoming Events?"
    },
    {
      "parameters": {
        "url": "http://38.242.139.159:3005/api/checklist/settings",
        "options": {
          "timeout": 8000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        600,
        1500
      ],
      "id": "c335eaef-3a73-460e-92f9-01955704ffcf",
      "name": "Get Settings for Reminder",
      "continueOnFail": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "={{ $('Check Upcoming Events').first().json.upcoming }}",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        800,
        1500
      ],
      "id": "2b48f54e-7082-4242-83b6-ec546daaacbf",
      "name": "Split Events"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "Mahmoud Magdy",
        "remoteJid": "={{ $('Get Settings for Reminder').first().json.whatsapp_group_id }}",
        "messageText": "=â° *ØªØ°ÙƒÙŠØ±!*\n\nğŸ“Œ Ø¨Ø§Ù‚ÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù„Ù‰:\n\nğŸ¯ *{{ $json.title }}*\nğŸ“ Ø§Ù„Ù…ÙƒØ§Ù†: {{ $json.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}\nğŸ• Ø§Ù„ÙˆÙ‚Øª: {{ new Date($json.event_time).toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit', timeZone: 'Africa/Cairo'}) }}\n{{ $json.description ? '\\nğŸ“ ' + $json.description : '' }}\n\nØ§Ø³ØªØ¹Ø¯ÙˆØ§! ğŸš€",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-english.evolutionApi",
      "typeVersion": 1,
      "position": [
        1000,
        1500
      ],
      "id": "8ee92d13-c231-4841-836a-46d4372c3415",
      "name": "Send Reminder to Group",
      "credentials": {
        "evolutionApi": {
          "id": "IGwXyU5Jbou5S5V3",
          "name": "Business Number"
        }
      }
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=http://38.242.139.159:3005/api/agenda/{{ $json.id }}/reminder-sent",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1200,
        1500
      ],
      "id": "d126dcb6-5f46-4b06-83dc-aace680631ba",
      "name": "Mark Reminder Sent"
    }
  ],
  "connections": {
    "Whatsapp": {
      "main": [
        [
          {
            "node": "Extract Message Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Message Data": {
      "main": [
        [
          {
            "node": "Is Not Empty?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Not Empty?": {
      "main": [
        [
          {
            "node": "Get Routing Settings",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Routing Settings": {
      "main": [
        [
          {
            "node": "Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Data for Manager": {
      "main": [
        [
          {
            "node": "Get Tasks for Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Tasks for Manager": {
      "main": [
        [
          {
            "node": "Manager AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Azure OpenAI (Manager)": {
      "ai_languageModel": [
        [
          {
            "node": "Manager AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Manager AI Agent": {
      "main": [
        [
          {
            "node": "Send Reply to Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Group Tasks": {
      "main": [
        [
          {
            "node": "Get Group Complaints",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Group Complaints": {
      "main": [
        [
          {
            "node": "Group AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Azure OpenAI (Group)": {
      "ai_languageModel": [
        [
          {
            "node": "Group AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Search Task Tool": {
      "ai_tool": [
        [
          {
            "node": "Group AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Complete Task Tool": {
      "ai_tool": [
        [
          {
            "node": "Group AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Register Complaint Tool": {
      "ai_tool": [
        [
          {
            "node": "Group AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Group AI Agent": {
      "main": [
        [
          {
            "node": "Send Reply to Group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Reply to Group": {
      "main": [
        [
          {
            "node": "Has Complaint?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Complaint?": {
      "main": [
        [
          {
            "node": "Escalate to Manager",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Router": {
      "main": [
        [
          {
            "node": "Get Data for Manager",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Group Tasks",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Manual Client Handling",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Every Minute Trigger": {
      "main": [
        [
          {
            "node": "Check Upcoming Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Upcoming Events": {
      "main": [
        [
          {
            "node": "Has Upcoming Events?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Upcoming Events?": {
      "main": [
        [
          {
            "node": "Get Settings for Reminder",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Settings for Reminder": {
      "main": [
        [
          {
            "node": "Split Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Events": {
      "main": [
        [
          {
            "node": "Send Reminder to Group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Reminder to Group": {
      "main": [
        [
          {
            "node": "Mark Reminder Sent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "92132a66-560f-4832-a65f-0e4fc1396cdf"
  }
}